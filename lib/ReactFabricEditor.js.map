{"version":3,"sources":["../src/ReactFabricEditor.js"],"names":["Header","Content","Footer","Sider","ReactFabricEditor","props","applyFilter","index","filter","obj","state","canvas","getActiveObject","filters","applyFilters","renderAll","getFilter","applyFilterValue","prop","value","timeStart","Date","lock","cob","lockMovementX","lockMovementY","lockRotation","lockScalingFlip","lockScalingX","lockScalingY","lockUniScaling","reverse","c","set","setCoords","cloneHandle","copyData","JSON","parse","stringify","toObject","fabric","util","enlivenObjects","objects","forEach","o","top","left","add","upAndDown","bringForward","deleteSelect","remove","reset","clear","crop","el","console","log","type","alert","lastActive","clipTo","Rect","fill","originX","originY","stroke","strokeDashArray","strokWidth","opacity","width","height","borderColor","cornerColor","hasRotatingPoint","selectable","selection_object_left","selection_object_top","scaleX","scaleY","setActiveObject","isCropping","cropImage","parseInt","png","canvas_crop","Canvas","Image","fromURL","toDataURL","img","setHeight","setWidth","croppedImg","saveTran","document","getElementById","ctx","getContext","imgData","getImageData","putImageData","trim","a","createElement","href","replace","click","saveCrop","canvasEl","cropObj","src","clearRect","sw","sh","setTimeout","drawImage","sx","sy","save","json","toJSON","onChange","setState","inputValue","tranformHandler","isTran","tranItem","tranformSave","onUploadFun","data","readPath","setSrc","md5list","temp","setAttribute","filterHandler","filterVisible","Brightness","Contrast","Saturation","Blur","onBrightnessChange","v","brightness","onContrastChange","contrast","onSaturationChange","saturation","onBlurChange","blur","onHueChange","hue","onOpacityChange","Math","round","itemClickHandler","option","abc","oImg","renderItem","key","names","accounts","split","marginLeft","display","collapsed","length","onCollapse","tranformRet","restore","uploadOpus","onAddFun","showPop","url","pselectUrl","onSelectFun","dots","dotscopy","idots","count","nextProps","loadFromJSON","webglBackend","WebglFilterBackend","canvas2dBackend","Canvas2dFilterBackend","filterBackend","Object","prototype","transparentCorners","on","e","target","getSrc","preserveObjectStacking","stateful","getWin","delectMouse","body","clientHeight","content","lineHeight","margin","padding","background","minHeight","bind","position","border","visibility","Component"],"mappings":"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","file":"ReactFabricEditor.js","sourcesContent":["/**\n * Created by fenghuitao on 17-8-28.\n */\nimport React, { Component } from 'react';\nimport { Button, Popover } from 'antd';\nimport 'fabric';\nimport matrix from './matrix';\nimport Tran from './tran.js';\nimport ImgFilter from './filter.js';\nimport { Slider, Input, Row, Col, Layout, Menu, Breadcrumb, Icon } from 'antd';\nconst { Header, Content, Footer, Sider } = Layout;\nimport 'babel-polyfill';\nimport test from './test';\n// import OperatorPanel from './panel/OperatorPanel'\n\n\n\nclass ReactFabricEditor extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      url: '',//父级点击传给的数据rul\n      filterVisible: false,\n      collapsed: false,\n      canvas: null,\n      isTran: false,\n      tranItem: null,\n      brightness: 0,\n      contrast: 0,\n      saturation: 0,\n      blur: 0,\n      hue: 0,\n      opacity: 0,\n      data: this.props.data,\n      pselectUrl: this.props.pselectUrl,\n      onSelectFun: this.props.onSelectFun,\n      onUploadFun: this.props.onUploadFun,\n      readPath: this.props.readPath,\n      onAddFun: this.props.onAddFun,\n    };\n    this.dots = [];\n    this.dotscopy = null;\n    this.idots = null;\n    this.count = 10;\n    this.el, this.lastActive, this.cob;\n    this.selection_object_left = 0;\n    this.selection_object_top = 0;\n    this.isCropping = false;\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.pselectUrl !== '') {\n      fabric.Image.fromURL(nextProps.pselectUrl, (oImg) => {\n        this.state.canvas.add(oImg);\n        this.state.canvas.renderAll();\n      }, {});\n    }\n    if(nextProps.data){\n      this.state.canvas.loadFromJSON(nextProps.data, () => { console.log('恢复完毕！') })\n    }\n  }\n\n  // static propTypes = {\n  //   onSelectFun: React.PropTypes.func.isRequired,//点击回调父级方法\n  //   uploadUrl: React.PropTypes.string.isRequired,//保存数据url\n  //   dataUrl: React.PropTypes.string.isRequired,//获得数据rul\n  // };\n\n\n  applyFilter = (index, filter) => {\n    var obj = this.state.canvas.getActiveObject();\n    obj.filters[index] = filter;\n    obj.applyFilters();\n    this.state.canvas.renderAll();\n  }\n\n  getFilter = (index) => {\n    var obj = this.state.canvas.getActiveObject();\n    return obj.filters[index];\n  }\n\n  applyFilterValue = (index, prop, value) => {\n    var obj = this.state.canvas.getActiveObject();\n    if (obj.filters[index]) {\n      obj.filters[index][prop] = value;\n      var timeStart = +new Date();\n      obj.applyFilters();\n      this.state.canvas.renderAll();\n    }\n  }\n\n  componentDidMount() {\n    if (!this.state.canvas) {\n      let webglBackend = new fabric.WebglFilterBackend();\n      let canvas2dBackend = new fabric.Canvas2dFilterBackend();\n\n      fabric.filterBackend = webglBackend;\n      fabric.Object.prototype.transparentCorners = false;\n\n      let canvas = new fabric.Canvas(\"canvas\");\n      canvas.on('object:selected', (e) => {\n        if (this.state.onSelectFun && e.target.getSrc) {\n          this.state.onSelectFun(e.target.getSrc());\n        }\n      });\n      canvas.preserveObjectStacking = true;\n      canvas.stateful = true;\n      this.setState({ canvas });\n      canvas.setWidth(1103);\n      canvas.setHeight(500);\n      canvas.loadFromJSON(this.state.data, () => { console.log('恢复完毕！') })\n    }\n  }\n\n  componentDidUpdate() {\n    if (this.state.isTran) {\n      Tran.getWin(document.getElementById(\"canvas_tran\"), this.state.tranItem);\n    }\n    else {\n      Tran.delectMouse();\n    }\n  }\n\n  lock = () => {\n    let cob = this.state.canvas.getActiveObject();\n    cob.lockMovementX = !cob.lockMovementX\n    cob.lockMovementY = !cob.lockMovementY;\n    cob.lockRotation = !cob.lockRotation;\n    cob.lockScalingFlip = !cob.lockScalingFlip;\n    cob.lockScalingX = !cob.lockScalingX;\n    cob.lockScalingY = !cob.lockScalingY;\n    cob.lockUniScaling = !cob.lockUniScaling;\n  }\n\n  //reverse\n  reverse = () => {\n    let c = this.state.canvas.getActiveObject();\n    if (c && !c.lockMovementX) {\n      c.set('scaleX', -1);\n      c.setCoords();\n      this.state.canvas.renderAll();\n    }\n  }\n\n  //clone\n  cloneHandle = () => {\n    let c = this.state.canvas.getActiveObject();\n    let copyData = JSON.parse(JSON.stringify(c.toObject()));\n    fabric.util.enlivenObjects([copyData], (objects) => {\n      objects.forEach((o) => {\n        o.set('top', o.top + 15);\n        o.set('left', o.left + 15);\n        this.state.canvas.add(o);\n        o.setCoords();\n      });\n      this.state.canvas.renderAll();\n    });\n  }\n  upAndDown = () => {\n    let cob = this.state.canvas.getActiveObject();\n    this.state.canvas.bringForward(cob)\n  }\n\n  deleteSelect = () => {\n    this.state.canvas.remove(this.state.canvas.getActiveObject());\n    this.state.canvas.renderAll();\n  }\n  reset = () => {\n    this.state.canvas.clear();\n  }\n\n  //剪切\n  crop = () => {\n    this.state.canvas.remove(this.el);\n    this.state.canvas.renderAll();\n    console.log(this.state.canvas, )\n    if (this.state.canvas.getActiveObject()) {\n      this.cob = this.state.canvas.getActiveObject();\n      if (this.cob.type === 'sprite') {\n        alert(\"所选对象不可裁剪。\");\n        return;\n      } else {\n        if (this.lastActive !== this.cob) {\n          console.log('different object');\n        } else {\n          console.log('same object');\n        }\n        if (this.lastActive && this.lastActive !== this.cob) {\n          this.lastActive.clipTo = null;\n        }\n\n        //生成一个和待裁剪元素相同大小的矩形用于框选裁剪区域\n        this.el = new fabric.Rect({\n          fill: 'rgba(0,0,0,0)',\n          originX: 'left',\n          originY: 'top',\n          stroke: '#ccc',\n          strokeDashArray: [2, 2],\n          strokWidth: 5,\n          opacity: 1,\n          width: 1,\n          height: 1,\n          borderColor: '#36fd00',\n          cornerColor: 'green',\n          hasRotatingPoint: false,\n          selectable: true\n        });\n\n        this.el.left = this.cob.left;\n        this.selection_object_left = this.cob.left;\n        this.selection_object_top = this.cob.top;\n        this.el.top = this.cob.top;\n        this.el.width = this.cob.width * this.cob.scaleX;\n        this.el.height = this.cob.height * this.cob.scaleY;\n        this.state.canvas.add(this.el);\n        this.state.canvas.setActiveObject(this.el);\n      }\n      this.isCropping = true;\n    } else if (this.isCropping) {\n      let left = this.el.left - this.cob.left;\n      let top = this.el.top - this.cob.top;\n\n      left *= 1;\n      top *= 1;\n\n      let width = this.el.width * 1;\n      let height = this.el.height * 1;\n\n      this.state.canvas.remove(this.cob);\n      this.state.canvas.remove(this.state.canvas.getActiveObject());\n\n      //将当前帧导出到一个新的canvas中并执行裁剪，在此期间暂停记录历史记录。\n      this.cropImage(this.cob, this.el.left, this.el.top, parseInt(this.el.scaleY * height), parseInt(width * this.el.scaleX));\n\n      this.lastActive = this.cob;\n      this.state.canvas.renderAll();\n\n      this.isCropping = false;\n    }\n  }\n  cropImage = (png, left, top, height, width) => {\n    //将图片放进一个新的canvas中，经裁剪后导出一个新的图片。\n    //如果用户选框大于原图片，则将选框缩至原图片大小\n    if (top < png.top) {\n      height = height - (png.top - top);\n      top = png.top;\n    }\n    if (left < png.left) {\n      width = width - (png.left - left);\n      left = png.left;\n    }\n    if (top + height > png.top + png.height * png.scaleY)\n      height = png.top + png.height * png.scaleY - top;\n    if (left + width > png.left + png.width * png.scaleX)\n      width = png.left + png.width * png.scaleX - left;\n\n    let canvas_crop = new fabric.Canvas(\"canvas_crop\");\n\n    fabric.Image.fromURL(canvas.toDataURL('png'), (img) => {\n      img.set('left', -(left + 1));\n      img.set('top', -(top + 1));\n      canvas_crop.add(img)\n      canvas_crop.setHeight(height);\n      canvas_crop.setWidth(width);\n      canvas_crop.renderAll();\n      fabric.Image.fromURL(canvas_crop.toDataURL('png'), (croppedImg) => {\n        croppedImg.set('left', left);\n        croppedImg.set('top', top);\n        this.state.canvas.add(croppedImg).renderAll();\n      });\n    });\n  }\n\n  saveTran = () => {\n    var canvas = document.getElementById('canvas_tran');\n    let ctx = canvas.getContext('2d');\n    let imgData = ctx.getImageData(0, 0, canvas.width, canvas.height)\n    ctx.putImageData(ImgFilter.trim(imgData), 0, 0)\n\n    let a = document.createElement('a');\n    a.href = canvas.toDataURL().replace('image/png', 'image/octet-stream');\n    a.click();\n  }\n  saveCrop = () => {\n    let canvasEl = document.getElementById('canvas_tran');\n    let ctx = canvasEl.getContext('2d');\n    let imgData = ctx.getImageData(0, 0, canvasEl.width, canvasEl.height)\n    let cropObj = ImgFilter.crop(imgData)\n\n    let img = new Image()\n    img.src = canvasEl.toDataURL();\n    ctx.clearRect(0, 0, canvasEl.width, canvasEl.height)\n    canvasEl.width = cropObj.sw\n    canvasEl.height = cropObj.sh\n    setTimeout(() => {\n      ctx.drawImage(img, cropObj.sx, cropObj.sy, cropObj.sw, cropObj.sh, 0, 0, canvasEl.width, canvasEl.height);\n    }, 0);\n  }\n\n  save = () => {\n    let json = this.state.canvas.toJSON();\n    console.log(JSON.stringify(json));\n  }\n\n  onChange = (value) => {\n    this.setState({\n      inputValue: value > 0 ? \"+\" + value : value,\n    });\n  }\n\n  tranformHandler = () => {\n    this.setState({ isTran: true, tranItem: this.state.canvas.getActiveObject() });\n  }\n\n  tranformSave = () => {\n\n    let canvasEl = document.getElementById('canvas_tran');\n    let ctx = canvasEl.getContext('2d');\n    let imgData = ctx.getImageData(0, 0, canvasEl.width, canvasEl.height)\n    let cropObj = ImgFilter.crop(imgData)\n\n    let img = new Image();\n    img.src = canvasEl.toDataURL();\n    ctx.clearRect(0, 0, canvasEl.width, canvasEl.height)\n    canvasEl.width = cropObj.sw;\n    canvasEl.height = cropObj.sh;\n    this.setState({ isTran: false });\n    setTimeout(async () => {\n      ctx.drawImage(img, cropObj.sx, cropObj.sy, cropObj.sw, cropObj.sh, 0, 0, canvasEl.width, canvasEl.height);\n      let data = await this.state.onUploadFun({ \"imgData\": canvasEl.toDataURL() });\n      if (this.state.readPath) {\n        this.state.canvas.getActiveObject().setSrc(this.state.readPath + data.md5list[0], () => {\n          this.state.canvas.renderAll();\n          let temp = document.getElementById('canvas_tran');\n          temp.setAttribute('width', 800 + 'px');\n          temp.setAttribute('height',600+'px');\n        });\n      }\n    }, 0);\n  }\n\n\n  filterHandler = () => {\n    if (this.state.filterVisible) return;\n    let c = this.state.canvas.getActiveObject();\n    if (c) {\n      this.applyFilter(0, new fabric.Image.filters.Brightness());\n      this.applyFilter(1, new fabric.Image.filters.Contrast());\n      this.applyFilter(2, new fabric.Image.filters.Saturation());\n      this.applyFilter(3, new fabric.Image.filters.Blur());\n    }\n  }\n  onBrightnessChange = (v) => {\n    this.setState({ brightness: v })\n    this.applyFilterValue(0, 'brightness', v / 200);\n  }\n  onContrastChange = (v) => {\n    this.setState({ contrast: v })\n    this.applyFilterValue(1, 'contrast', v / 200);\n  }\n  onSaturationChange = (v) => {\n    this.setState({ saturation: v })\n    this.applyFilterValue(2, 'saturation', v * .8);\n  }\n  onBlurChange = (v) => {\n    this.setState({ blur: v })\n    this.applyFilterValue(3, 'blur', v / 100);\n  }\n  onHueChange = (v) => {\n    this.setState({ hue: v })\n    this.applyFilterValue(4, 'rotation', v);\n  }\n  onOpacityChange = (v) => {\n    this.setState({ opacity: v })\n    this.state.canvas.getActiveObject().set('opacity', Math.round(100 - .9 * v) / 100);\n    this.state.canvas.renderAll();\n  }\n\n  itemClickHandler = (v) => {\n    console.log(v);\n    let option = { abc: v };\n    fabric.Image.fromURL(v, (oImg) => {\n      this.state.canvas.add(oImg);\n      console.log(option);\n      this.state.canvas.renderAll();\n    }, option);\n  }\n  renderItem = (index, key) => {\n    let names = this.state.accounts[index].split('/');\n    return <div style={{ height: 65 }} onClick={() => this.itemClickHandler(this.state.accounts[index])} key={this.state.accounts[index]}><img src={this.state.accounts[index]} style={{ width: 50, height: 60, marginLeft: \"10px\" }} /><span style={{ marginLeft: \"10px\", display: !this.state.collapsed ? '' : \"none\" }} >{names[names.length - 1]}</span></div>;\n  }\n\n  onCollapse = (collapsed) => {\n    console.log(collapsed);\n    this.setState({ collapsed });\n  }\n\n  tranformRet = () => {\n\n    if (this.state.isTran) {\n      this.setState({ isTran: false });\n    } else {\n      this.state.canvas.getContext('2d').restore();\n    }\n  }\n\n  uploadOpus = () => {\n      this.state.onAddFun && this.state.onAddFun({ \"item\": { \"value\": JSON.stringify(this.state.canvas.toJSON()) } })\n    // let data = await api(\"http://127.0.0.1:22222/System/addItem\", { \"item\": { \"value\": JSON.stringify(this.state.canvas.toJSON()) } });\n    // console.log(data, '------------------------');\n  }\n\n  showPop = () => {\n    this.setState({\n      filterVisible: !this.state.filterVisible,\n    });\n  }\n\n  render() {\n    let sh = document.body.clientHeight - 53;\n    const content = (\n      <div style={{ lineHeight: '32px' }}>\n        <Row>\n          <Col span={4}>\n            <div >亮度</div>\n          </Col>\n          <Col span={18}>\n            <Slider min={-100} max={+100} onChange={this.onBrightnessChange} value={this.state.brightness} />\n          </Col>\n          <Col span={2}>\n            <div style={{ marginLeft: 5 }}>{this.state.brightness}</div>\n          </Col>\n        </Row>\n        <Row>\n          <Col span={4}>\n            <div >对比度</div>\n          </Col>\n          <Col span={18}>\n            <Slider min={-100} max={+100} onChange={this.onContrastChange} value={this.state.contrast} />\n          </Col>\n          <Col span={2}>\n            <div style={{ marginLeft: 5 }}>{this.state.contrast}</div>\n          </Col>\n        </Row>\n        <Row>\n          <Col span={4}>\n            <div >饱和度</div>\n          </Col>\n          <Col span={18}>\n            <Slider min={-100} max={+100} onChange={this.onSaturationChange} value={this.state.saturation} />\n          </Col>\n          <Col span={2}>\n            <div style={{ marginLeft: 5 }}>{this.state.saturation}</div>\n          </Col>\n        </Row>\n        <Row>\n          <Col span={4}>\n            <div >清晰度</div>\n          </Col>\n          <Col span={18}>\n            <Slider min={0} max={100} onChange={this.onBlurChange} value={this.state.blur} />\n          </Col>\n          <Col span={2}>\n            <div style={{ marginLeft: 5 }}>{this.state.blur}</div>\n          </Col>\n        </Row>\n        <Row>\n          <Col span={4}>\n            <div >色彩</div>\n          </Col>\n          <Col span={18}>\n            <Slider min={-100} max={+100} onChange={this.onHueChange} value={this.state.hue} />\n          </Col>\n          <Col span={2}>\n            <div style={{ marginLeft: 5 }}>{this.state.hue}</div>\n          </Col>\n        </Row>\n        <Row>\n          <Col span={4}>\n            <div >透明度</div>\n          </Col>\n          <Col span={18}>\n            <Slider min={0} max={+100} onChange={this.onOpacityChange} value={this.state.opacity} />\n          </Col>\n          <Col span={2}>\n            <div style={{ marginLeft: 5 }}>{this.state.opacity}%</div>\n          </Col>\n        </Row>\n      </div>\n    );\n    return (\n      <div>\n        <Layout>\n          <Content style={{ margin: '0 16px' }}>\n            <Breadcrumb style={{ margin: '12px 0' }}>\n              <Breadcrumb.Item>User</Breadcrumb.Item>\n              <Breadcrumb.Item>Bill</Breadcrumb.Item>\n            </Breadcrumb>\n            <div style={{ padding: 24, background: '#fff', minHeight: 360 }}>\n              <Popover content={content} title={null} visible={this.state.filterVisible} onClick={this.showPop} overlayStyle={{ width: '300px' }}>\n                <Button onClick={this.filterHandler}>滤镜</Button>\n              </Popover>\n              {/* <OperatorPanel/> */}\n              <Button onClick={this.crop}>剪切</Button>\n              <Button onClick={this.cloneHandle}>复制</Button>\n              <Button onClick={this.reverse}>反转</Button>\n              <Button onClick={this.lock}>锁定</Button>\n              <Button onClick={this.upAndDown}>层级</Button>\n              <Button onClick={this.tranformHandler}>变形</Button>\n\n              <Button onClick={this.save}>保存</Button>\n              <Button onClick={this.saveTran}> 去除白色&下载</Button>\n              <Button onClick={this.tranformRet.bind(this)}>还原</Button>\n\n              <Button onClick={this.tranformSave}>保存变形</Button>\n              <Button onClick={this.uploadOpus}>上传作品</Button>\n              <Button onClick={this.deleteSelect} >删除</Button>\n              <Button onClick={this.reset}>重置</Button>\n              <div style={{ position: \"relative\" }}>\n                <canvas id='canvas'\n                  width=\"800\" height=\"600\" style={{\n                    border: '1px solid grey',\n                    'borderRadius': '2px'\n                  }}></canvas>\n                <canvas style={{\n                  visibility: \"hidden\", position: \"absolute\", left: \"0px\", display: \"inline-block\",\n                  top: \"0px\"\n                }} id=\"canvas_crop\"></canvas>\n                <canvas id=\"canvas_tran\" width=\"800\" height=\"600\" visibility={false} style={{\n                  position: \"absolute\", left: \"-5px\", display: \"inline-block\",\n                  top: \"0px\",\n                  margin: 'auto',\n                  border: '1px solid grey',\n                  'borderRadius': '2px',\n                  display: this.state.isTran ? 'block' : \"none\",\n                }}></canvas>\n\n              </div>\n            </div>\n          </Content>\n        </Layout>\n      </div>\n    );\n  }\n}\n\nexport default ReactFabricEditor\n"]}